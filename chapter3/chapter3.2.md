# 3. 인덱스 튜닝

## 3.2 부분범위 처리 활용

### 3.2.1 부분범위 처리

#### '부분범위 처리'란?
- '부분범위 처리'는 테이블 랜덤 액세스로 인한 인덱스 손익분기점 한계를 극복하는 방법이다.
- '부분범위 처리'를 사용하면 인덱스로 액세스할 대상 레코드가 아무리 많아도 아주 빠른 응답속도를 낼 수 있다..
- 즉, '부분범위 처리'란 바로 전체 쿼리 결과집합을 연속적으로 전송하지 않고, 사용자로부터 Fetch Call이 있을 때마다 일정량씩 나누어 전송하는 방식이다. 
- 일정량씩 데이터를 전송하는 단위를 'Array Size'라고 한다. 

#### 1억 건짜리 테이블 부분범위 처리 과정 
> 부분범위 처르를 활용하면 DBMS가 데이터를 모두 읽어 한 번에 전송하지 않고 먼저 읽는 데이터부터 일정량을 전송하기 멈추기 때문에 결과를 빨리 출력할 수 있다. 

1. DBMS는 먼저 읽은 데이터부터 일정량을 전송한다. 
2. 일정량의 데이터를 전송하고 나면, DB서버 프로세스는 CPU를 OS에 반환하고 대기큐에서 잠을 잔다. 
3. 그리고 다음 Fetch Call을 받으면 대기 큐에서 나와 그 다음 데이터를 전송하고 잠을 잔다. 

#### 전체범위 처리 vs 부분범위 처리

- 쿼리에 order by가 있어서, DB서버가 '모든' 데이터를 다 읽어 정렬을 마치고나서 클라이언트에게 데이터를 전송을 시작하는 것은 '전체범위' 처리이다.
- 만약 정렬 조건에 쓰인 컬럼이 선두인 인덱스가 있다면, 인덱스 내에서 정렬되어 있기 때문에 부분범위 처리가 가능하다.
- 하지만 인덱스가 없다면, 정렬을 다 마치고 일정량씩 데이터를 전송해야 하기 때문에 부분범위 처리가 불가능하다.

#### Array Size 전략은?
- 대량이라면 Array Size값을 크게 해야, Fetch Call 건수를 줄일 수 있다. 
- 앞쪽 일부 데이터만 Fetch하다가 멈추는 프로그램이라면, Array Size작게 설정해야 비효율을 줄일 수 있다.  
	- Array Size가 불필요하게 크면, 쓸데없이 많은 데이터를 읽어 전송해버릴 수 있기 때문이다.  

### 3.2.2 부분범위 처리 구현

### 3.2.3 OLTP 환경에서 부분범위 처리에 의한 성능개선 원리

